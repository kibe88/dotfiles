# make everything run under utf8
set -g utf8
setw -g utf8 on
set -g status-utf8 on # for the status bar

# launchctl under tmux fix
set-option -g default-command "reattach-to-user-namespace -l bash"

# improve colors
set -g default-terminal "xterm-256color"
setw -g xterm-keys on

# act like vim
setw -g mode-keys vi
bind -n C-h run "(tmux display-message -p '#{pane_current_command}' | grep -iq vim && tmux send-keys C-h) || tmux select-pane -L"
bind -n C-j run "(tmux display-message -p '#{pane_current_command}' | grep -iq vim && tmux send-keys C-j) || tmux select-pane -D"
bind -n C-k run "(tmux display-message -p '#{pane_current_command}' | grep -iq vim && tmux send-keys C-k) || tmux select-pane -U"
bind -n C-l run "(tmux display-message -p '#{pane_current_command}' | grep -iq vim && tmux send-keys C-l) || tmux select-pane -R"
bind -n C-\ run "(tmux display-message -p '#{pane_current_command}' | grep -iq vim && tmux send-keys 'C-\\') || tmux select-pane -l"
# vim like copy and paste (requires reattach-to-user-namespace)
# Update default binding of `Enter` to also use copy-pipe
unbind -t vi-copy Enter
bind-key -t vi-copy Enter copy-pipe "reattach-to-user-namespace pbcopy"

# C-l is taken over by vim style pane navigation
bind C-l send-keys 'C-l'

# start window numbers at 1 to match keyboard order with tmux window order
set -g base-index 1
setw -g pane-base-index 1

# renumber windows sequentially after closing any of them
set -g renumber-windows on

# auto rename window titles based on running command
setw -g automatic-rename on

# soften status bar color from harsh green to light gray
set -g status-bg colour237
set -g status-fg '#7c6f64'

# customize statusbar pane tab colors
setw -g window-status-current-fg colour210
setw -g window-status-current-bg colour235
setw -g window-status-current-attr bold
setw -g window-status-current-format '  #I #[fg=colour255]#W#[fg=colour210]#F  '

setw -g window-status-fg colour138
setw -g window-status-bg colour237
setw -g window-status-attr none
setw -g window-status-format '  #I #[fg=colour244]#W#[fg=colour138]#F  '

setw -g window-status-bell-attr bold
setw -g window-status-bell-fg colour255
setw -g window-status-bell-bg colour1

# increase scrollback lines
set -g history-limit 10000

# bind prefix key to ctrl a
set -g prefix C-s
unbind C-b # free up original keybind
bind C-s send-prefix # use send-prefix to pass C-a through to application

# TODO: check tmux version and use the relevant settings
# mouse mode settings for tmux >= 2.1
set-option -g mouse on
bind-key -T root WheelUpPane \
  if-shell -Ft= '#{mouse_any_flag}' 'send-keys -M' \
  'if-shell -Ft= "#{pane_in_mode}" "send-keys -M" "copy-mode"'

bind-key -T root WheelDownPane \
  if-shell -Ft= '#{mouse_any_flag}' 'send-keys -M' \
  'if-shell -Ft= "#{pane_in_mode}" "send-keys -M"'

# sets mouse mode on tmux <= 2.0
#set -g mode-mouse on
#set -g mouse-resize-pane on
#set -g mouse-select-pane on
#set -g mouse-select-window on

# show host name and IP address on left side of status bar
set -g status-left-length 0
set -g status-left ''

# show session name, window & pane number, date and time on right side of status bar
set -g status-right-length 80
set -g status-right "#[fg=colour244]s#[fg=colour210]#S #[fg=colour244]w#[fg=colour210]#I #[fg=colour244]p#[fg=colour210]#P #[fg=colour138]:: #[fg=colour244]#(whoami)#[fg=colour210]@#[fg=colour244]#h#[fg=colour210][#[fg=colour244]#(curl icanhazip.com)#[fg=colour210]] #[fg=colour138]:: #[fg=colour245]%d %b %Y #[fg=colour138]:: #[fg=colour245]%H:%M"

# switch windows using alt+number
bind-key -n M-1 select-window -t 1
bind-key -n M-2 select-window -t 2
bind-key -n M-3 select-window -t 3
bind-key -n M-4 select-window -t 4
bind-key -n M-5 select-window -t 5
bind-key -n M-6 select-window -t 6
bind-key -n M-7 select-window -t 7
bind-key -n M-8 select-window -t 8
bind-key -n M-9 select-window -t 9

# source tmux conf file using r
bind-key r source-file ~/.tmux.conf \; display-message "Config reloaded"

# more intuitive keybindings for splitting
unbind %
bind h split-window -v # horizontal split
unbind '"'
bind v split-window -h # vertical split

# Local config
if-shell "[ -f ~/.tmux.conf.local ]" 'source ~/.tmux.conf.local'
