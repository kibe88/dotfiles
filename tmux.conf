# Source config based on current os
if-shell "[[ `uname` =~ .*Darwin.* ]]" "source-file ${HOME}/.tmux_osx.conf"
if-shell "[[ `uname` =~ .*Linux.* ]]" "source-file ${HOME}/.tmux_linux.conf"

# improve color pallete
set -g default-terminal "xterm-256color"
# enable terminal compability
set-option -ga terminal-overrides ",xterm-256color:Tc"
setw -g xterm-keys on

# Act like vim
setw -g mode-keys vi
# Vim like pane switching with awareness of vim splits (so you can safely navigate using the same keys)
bind -n C-h run "(tmux display-message -p '#{pane_current_command}' | grep -iq vim && tmux send-keys C-h) || tmux select-pane -L"
bind -n C-j run "(tmux display-message -p '#{pane_current_command}' | grep -iq vim && tmux send-keys C-j) || tmux select-pane -D"
bind -n C-k run "(tmux display-message -p '#{pane_current_command}' | grep -iq vim && tmux send-keys C-k) || tmux select-pane -U"
bind -n C-l run "(tmux display-message -p '#{pane_current_command}' | grep -iq vim && tmux send-keys C-l) || tmux select-pane -R"
bind -n C-\ run "(tmux display-message -p '#{pane_current_command}' | grep -iq vim && tmux send-keys 'C-\\') || tmux select-pane -l"

# C-l is taken over by vim style pane navigation
bind C-l send-keys 'C-l'

# Setup 'v' to begin selection as in Vim
bind-key -T copy-mode-vi 'v' send -X begin-selection;
bind-key -T copy-mode-vi 'y' send-keys -X copy-pipe-and-cancel 'reattach-to-user-namespace pbcopy';
unbind -T copy-mode-vi Enter;
bind-key -T copy-mode-vi Enter send-keys -X copy-pipe-and-cancel 'reattach-to-user-namespace pbcopy'

# Quick pane selection
bind -r C-p select-window -t :-
bind -r C-n select-window -t :+

# start window numbers at 1 to match keyboard order with tmux window order
set -g base-index 1
setw -g pane-base-index 1

# renumber windows sequentially after closing any of them
set -g renumber-windows on

# auto rename window titles based on running command
setw -g automatic-rename on

# soften status bar color from harsh green to light gray
set -g status-bg colour237
set -g status-fg '#7c6f64'

# customize statusbar pane tab colors
setw -g window-status-current-fg colour210
setw -g window-status-current-bg colour235
setw -g window-status-current-attr bold
setw -g window-status-current-format '  #I #[fg=colour255]#W#[fg=colour210]#F  '

setw -g window-status-fg colour138
setw -g window-status-bg colour237
setw -g window-status-attr none
setw -g window-status-format '  #I #[fg=colour244]#W#[fg=colour138]#F  '

setw -g window-status-bell-attr bold
setw -g window-status-bell-fg colour255
setw -g window-status-bell-bg colour1

# increase scrollback lines
set -g history-limit 10000

# bind prefix key to ctrl a
set -g prefix C-f
unbind C-b # free up original keybind
bind C-f send-prefix # use send-prefix to pass C-a through to application

# TODO: check tmux version and use the relevant settings
# mouse mode settings for tmux >= 2.1
set-option -g mouse on
bind-key -T root WheelUpPane \
  if-shell -Ft= '#{mouse_any_flag}' 'send-keys -M' \
  'if-shell -Ft= "#{pane_in_mode}" "send-keys -M" "copy-mode"'

bind-key -T root WheelDownPane \
  if-shell -Ft= '#{mouse_any_flag}' 'send-keys -M' \
  'if-shell -Ft= "#{pane_in_mode}" "send-keys -M"'

# sets mouse mode on tmux <= 2.0
#set -g mode-mouse on
#set -g mouse-resize-pane on
#set -g mouse-select-pane on
#set -g mouse-select-window on

# show host name and IP address on left side of status bar
set -g status-left-length 0
set -g status-left ''

# switch windows using alt+number
bind-key -n M-1 select-window -t 1
bind-key -n M-2 select-window -t 2
bind-key -n M-3 select-window -t 3
bind-key -n M-4 select-window -t 4
bind-key -n M-5 select-window -t 5
bind-key -n M-6 select-window -t 6
bind-key -n M-7 select-window -t 7
bind-key -n M-8 select-window -t 8
bind-key -n M-9 select-window -t 9

# source tmux conf file using r
bind-key r source-file ~/.tmux.conf \; display-message "Config reloaded"

# more intuitive keybindings for splitting
unbind %
bind h split-window -v -c "#{pane_current_path}" # horizontal split
unbind '"'
bind v split-window -h -c "#{pane_current_path}" # vertical split

# Disable anything related to bell (and its fucking beep!)
set -g bell-action none
set -g visual-bell off
set -g bell-on-alert off

# List of plugins
set -g @plugin 'tmux-plugins/tpm'
set -g @plugin 'arcticicestudio/nord-tmux'
set -g @plugin 'tmux-plugins/tmux-prefix-highlight'

# Initialize TMUX plugin manager (keep this line at the very bottom of tmux.conf)
run '~/.tmux/plugins/tpm/tpm'

# Local config
if-shell "[ -f ~/.tmux.conf.local ]" 'source ~/.tmux.conf.local'
